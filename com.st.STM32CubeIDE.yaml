app-id: com.st.STM32CubeIDE
runtime: org.gnome.Sdk
runtime-version: '3.36'
sdk: org.gnome.Sdk
sdk-extensions: 
  - org.freedesktop.Sdk.Extension.openjdk11
command: stm32cubeide
finish-args:
  - --socket=wayland
  - --socket=x11
  - --device=dri
  - --share=ipc
  - --socket=pulseaudio
  - --share=network
  - --allow=devel
  - --env=PATH=/app/bin:/app/jdk/bin:/usr/bin
modules:
  - name: openjdk
    buildsystem: simple
    build-commands: 
      - /usr/lib/sdk/openjdk11/installjdk.sh
  - name: stm32cubeide
    buildsystem: simple
    build-commands: 
      - chmod +x st-stm32cubeide_1.3.0_5720_20200220_1053_amd64.sh
      - ./st-stm32cubeide_1.3.0_5720_20200220_1053_amd64.sh --tar -xvf
      - mkdir ${FLATPAK_DEST}/bin/
      - tar -xzvf st-stm32cubeide_1.3.0_5720_20200220_1053_amd64.tar.gz -C ${FLATPAK_DEST}/bin/
      - install -D icon.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png
      - install -t ${FLATPAK_DEST}/share/applications/ -Dm644 com.st.STM32CubeIDE.desktop
      - install -t ${FLATPAK_DEST}/share/appdata/ -Dm644 com.st.STM32CubeIDE.metainfo.xml
    sources:
      - type: archive
        url: https://www.st.com/content/ccc/resource/technical/software/sw_development_suite/group0/8c/98/05/46/6e/30/42/37/stm32cubeide_lnx/files/st-stm32cubeide_1.3.0_5720_20200220_1053_amd64.sh.zip/jcr:content/translations/en.st-stm32cubeide_1.3.0_5720_20200220_1053_amd64.sh.zip  
        sha256: 7ee5b50075d178cc84530b4eed353cba55c894bce619800462e5238f042a38c4
      - type: file
        path: com.st.STM32CubeIDE.metainfo.xml
      - type: file
        path: com.st.STM32CubeIDE.desktop
      - type: file
        path: icon.png